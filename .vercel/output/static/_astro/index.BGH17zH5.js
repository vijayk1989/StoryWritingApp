import{n as j,b as Dt,f as S,s as B,r as Ct,c as Y,a as At}from"./index.Ba5BdeOo.js";import{a as $,b as O,c as Ft,m as F,u as I,d as N,e as P,f as R}from"./index.DslVvz7N.js";import{e as K}from"./Editor.CJH2FCh-.js";import{c as dt,v as Lt}from"./index.D8ScSV_8.js";import{t as W,s as at,a as ot,i as St,c as zt,b as ut,d as Tt,l as Rt}from"./list-item.C6BHWQ3y.js";import"./jsx-runtime.B-tYHWOS.js";import"./index.BCPtUIm2.js";import"./supabase.YDNJ6__1.js";import"./floating-ui.react-dom.BmbJoTtk.js";import"./index.D1eIsul2.js";import"./button.DSwAMVRZ.js";import"./index.BuzRTTe3.js";import"./iconBase.wJcibKWI.js";import"./useLorebookStore.GsEaYorD.js";import"./index.Bk4Tk5ow.js";import"./react.BoqmBW-A.js";import"./useChapterStore.BIfqi0n6.js";import"./index.BInd9SeV.js";import"./index.D7TIu75F.js";const Mt={tokenize:_t,partial:!0},st={tokenize:vt,partial:!0},ft={tokenize:Wt,partial:!0},ht={tokenize:Bt,partial:!0},It={tokenize:Ht,partial:!0},mt={tokenize:Ot,previous:pt},ct={tokenize:jt,previous:gt},L={tokenize:Pt,previous:kt},d={},Et={text:d};let T=48;for(;T<123;)d[T]=L,T++,T===58?T=65:T===91&&(T=97);d[43]=L;d[45]=L;d[46]=L;d[95]=L;d[72]=[L,ct];d[104]=[L,ct];d[87]=[L,mt];d[119]=[L,mt];function Pt(t,n,e){const r=this;let a,o;return i;function i(l){return!G(l)||!kt.call(r,r.previous)||Z(r.events)?e(l):(t.enter("literalAutolink"),t.enter("literalAutolinkEmail"),u(l))}function u(l){return G(l)?(t.consume(l),u):l===64?(t.consume(l),f):e(l)}function f(l){return l===46?t.check(It,c,m)(l):l===45||l===95||$(l)?(o=!0,t.consume(l),f):c(l)}function m(l){return t.consume(l),a=!0,f}function c(l){return o&&a&&O(r.previous)?(t.exit("literalAutolinkEmail"),t.exit("literalAutolink"),n(l)):e(l)}}function Ot(t,n,e){const r=this;return a;function a(i){return i!==87&&i!==119||!pt.call(r,r.previous)||Z(r.events)?e(i):(t.enter("literalAutolink"),t.enter("literalAutolinkWww"),t.check(Mt,t.attempt(st,t.attempt(ft,o),e),e)(i))}function o(i){return t.exit("literalAutolinkWww"),t.exit("literalAutolink"),n(i)}}function jt(t,n,e){const r=this;let a="",o=!1;return i;function i(l){return(l===72||l===104)&&gt.call(r,r.previous)&&!Z(r.events)?(t.enter("literalAutolink"),t.enter("literalAutolinkHttp"),a+=String.fromCodePoint(l),t.consume(l),u):e(l)}function u(l){if(O(l)&&a.length<5)return a+=String.fromCodePoint(l),t.consume(l),u;if(l===58){const p=a.toLowerCase();if(p==="http"||p==="https")return t.consume(l),f}return e(l)}function f(l){return l===47?(t.consume(l),o?m:(o=!0,f)):e(l)}function m(l){return l===null||Ft(l)||F(l)||I(l)||N(l)?e(l):t.attempt(st,t.attempt(ft,c),e)(l)}function c(l){return t.exit("literalAutolinkHttp"),t.exit("literalAutolink"),n(l)}}function _t(t,n,e){let r=0;return a;function a(i){return(i===87||i===119)&&r<3?(r++,t.consume(i),a):i===46&&r===3?(t.consume(i),o):e(i)}function o(i){return i===null?e(i):n(i)}}function vt(t,n,e){let r,a,o;return i;function i(m){return m===46||m===95?t.check(ht,f,u)(m):m===null||F(m)||I(m)||m!==45&&N(m)?f(m):(o=!0,t.consume(m),i)}function u(m){return m===95?r=!0:(a=r,r=void 0),t.consume(m),i}function f(m){return a||r||!o?e(m):n(m)}}function Wt(t,n){let e=0,r=0;return a;function a(i){return i===40?(e++,t.consume(i),a):i===41&&r<e?o(i):i===33||i===34||i===38||i===39||i===41||i===42||i===44||i===46||i===58||i===59||i===60||i===63||i===93||i===95||i===126?t.check(ht,n,o)(i):i===null||F(i)||I(i)?n(i):(t.consume(i),a)}function o(i){return i===41&&r++,t.consume(i),a}}function Bt(t,n,e){return r;function r(u){return u===33||u===34||u===39||u===41||u===42||u===44||u===46||u===58||u===59||u===63||u===95||u===126?(t.consume(u),r):u===38?(t.consume(u),o):u===93?(t.consume(u),a):u===60||u===null||F(u)||I(u)?n(u):e(u)}function a(u){return u===null||u===40||u===91||F(u)||I(u)?n(u):r(u)}function o(u){return O(u)?i(u):e(u)}function i(u){return u===59?(t.consume(u),r):O(u)?(t.consume(u),i):e(u)}}function Ht(t,n,e){return r;function r(o){return t.consume(o),a}function a(o){return $(o)?e(o):n(o)}}function pt(t){return t===null||t===40||t===42||t===95||t===91||t===93||t===126||F(t)}function gt(t){return!O(t)}function kt(t){return!(t===47||G(t))}function G(t){return t===43||t===45||t===46||t===95||$(t)}function Z(t){let n=t.length,e=!1;for(;n--;){const r=t[n][1];if((r.type==="labelLink"||r.type==="labelImage")&&!r._balanced){e=!0;break}if(r._gfmAutolinkLiteralWalkedInto){e=!1;break}}return t.length>0&&!e&&(t[t.length-1][1]._gfmAutolinkLiteralWalkedInto=!0),e}const Vt={tokenize:Jt,partial:!0};function qt(){return{document:{91:{tokenize:Nt,continuation:{tokenize:Zt},exit:Qt}},text:{91:{tokenize:$t},93:{add:"after",tokenize:Ut,resolveTo:Gt}}}}function Ut(t,n,e){const r=this;let a=r.events.length;const o=r.parser.gfmFootnotes||(r.parser.gfmFootnotes=[]);let i;for(;a--;){const f=r.events[a][1];if(f.type==="labelImage"){i=f;break}if(f.type==="gfmFootnoteCall"||f.type==="labelLink"||f.type==="label"||f.type==="image"||f.type==="link")break}return u;function u(f){if(!i||!i._balanced)return e(f);const m=j(r.sliceSerialize({start:i.end,end:r.now()}));return m.codePointAt(0)!==94||!o.includes(m.slice(1))?e(f):(t.enter("gfmFootnoteCallLabelMarker"),t.consume(f),t.exit("gfmFootnoteCallLabelMarker"),n(f))}}function Gt(t,n){let e=t.length;for(;e--;)if(t[e][1].type==="labelImage"&&t[e][0]==="enter"){t[e][1];break}t[e+1][1].type="data",t[e+3][1].type="gfmFootnoteCallLabelMarker";const r={type:"gfmFootnoteCall",start:Object.assign({},t[e+3][1].start),end:Object.assign({},t[t.length-1][1].end)},a={type:"gfmFootnoteCallMarker",start:Object.assign({},t[e+3][1].end),end:Object.assign({},t[e+3][1].end)};a.end.column++,a.end.offset++,a.end._bufferIndex++;const o={type:"gfmFootnoteCallString",start:Object.assign({},a.end),end:Object.assign({},t[t.length-1][1].start)},i={type:"chunkString",contentType:"string",start:Object.assign({},o.start),end:Object.assign({},o.end)},u=[t[e+1],t[e+2],["enter",r,n],t[e+3],t[e+4],["enter",a,n],["exit",a,n],["enter",o,n],["enter",i,n],["exit",i,n],["exit",o,n],t[t.length-2],t[t.length-1],["exit",r,n]];return t.splice(e,t.length-e+1,...u),t}function $t(t,n,e){const r=this,a=r.parser.gfmFootnotes||(r.parser.gfmFootnotes=[]);let o=0,i;return u;function u(l){return t.enter("gfmFootnoteCall"),t.enter("gfmFootnoteCallLabelMarker"),t.consume(l),t.exit("gfmFootnoteCallLabelMarker"),f}function f(l){return l!==94?e(l):(t.enter("gfmFootnoteCallMarker"),t.consume(l),t.exit("gfmFootnoteCallMarker"),t.enter("gfmFootnoteCallString"),t.enter("chunkString").contentType="string",m)}function m(l){if(o>999||l===93&&!i||l===null||l===91||F(l))return e(l);if(l===93){t.exit("chunkString");const p=t.exit("gfmFootnoteCallString");return a.includes(j(r.sliceSerialize(p)))?(t.enter("gfmFootnoteCallLabelMarker"),t.consume(l),t.exit("gfmFootnoteCallLabelMarker"),t.exit("gfmFootnoteCall"),n):e(l)}return F(l)||(i=!0),o++,t.consume(l),l===92?c:m}function c(l){return l===91||l===92||l===93?(t.consume(l),o++,m):m(l)}}function Nt(t,n,e){const r=this,a=r.parser.gfmFootnotes||(r.parser.gfmFootnotes=[]);let o,i=0,u;return f;function f(h){return t.enter("gfmFootnoteDefinition")._container=!0,t.enter("gfmFootnoteDefinitionLabel"),t.enter("gfmFootnoteDefinitionLabelMarker"),t.consume(h),t.exit("gfmFootnoteDefinitionLabelMarker"),m}function m(h){return h===94?(t.enter("gfmFootnoteDefinitionMarker"),t.consume(h),t.exit("gfmFootnoteDefinitionMarker"),t.enter("gfmFootnoteDefinitionLabelString"),t.enter("chunkString").contentType="string",c):e(h)}function c(h){if(i>999||h===93&&!u||h===null||h===91||F(h))return e(h);if(h===93){t.exit("chunkString");const b=t.exit("gfmFootnoteDefinitionLabelString");return o=j(r.sliceSerialize(b)),t.enter("gfmFootnoteDefinitionLabelMarker"),t.consume(h),t.exit("gfmFootnoteDefinitionLabelMarker"),t.exit("gfmFootnoteDefinitionLabel"),p}return F(h)||(u=!0),i++,t.consume(h),h===92?l:c}function l(h){return h===91||h===92||h===93?(t.consume(h),i++,c):c(h)}function p(h){return h===58?(t.enter("definitionMarker"),t.consume(h),t.exit("definitionMarker"),a.includes(o)||a.push(o),S(t,k,"gfmFootnoteDefinitionWhitespace")):e(h)}function k(h){return n(h)}}function Zt(t,n,e){return t.check(Dt,n,t.attempt(Vt,n,e))}function Qt(t){t.exit("gfmFootnoteDefinition")}function Jt(t,n,e){const r=this;return S(t,a,"gfmFootnoteDefinitionIndent",5);function a(o){const i=r.events[r.events.length-1];return i&&i[1].type==="gfmFootnoteDefinitionIndent"&&i[2].sliceSerialize(i[1],!0).length===4?n(o):e(o)}}function Xt(t){let e=(t||{}).singleTilde;const r={tokenize:o,resolveAll:a};return e==null&&(e=!0),{text:{126:r},insideSpan:{null:[r]},attentionMarkers:{null:[126]}};function a(i,u){let f=-1;for(;++f<i.length;)if(i[f][0]==="enter"&&i[f][1].type==="strikethroughSequenceTemporary"&&i[f][1]._close){let m=f;for(;m--;)if(i[m][0]==="exit"&&i[m][1].type==="strikethroughSequenceTemporary"&&i[m][1]._open&&i[f][1].end.offset-i[f][1].start.offset===i[m][1].end.offset-i[m][1].start.offset){i[f][1].type="strikethroughSequence",i[m][1].type="strikethroughSequence";const c={type:"strikethrough",start:Object.assign({},i[m][1].start),end:Object.assign({},i[f][1].end)},l={type:"strikethroughText",start:Object.assign({},i[m][1].end),end:Object.assign({},i[f][1].start)},p=[["enter",c,u],["enter",i[m][1],u],["exit",i[m][1],u],["enter",l,u]],k=u.parser.constructs.insideSpan.null;k&&B(p,p.length,0,Ct(k,i.slice(m+1,f),u)),B(p,p.length,0,[["exit",l,u],["enter",i[f][1],u],["exit",i[f][1],u],["exit",c,u]]),B(i,m-1,f-m+3,p),f=m+p.length-2;break}}for(f=-1;++f<i.length;)i[f][1].type==="strikethroughSequenceTemporary"&&(i[f][1].type="data");return i}function o(i,u,f){const m=this.previous,c=this.events;let l=0;return p;function p(h){return m===126&&c[c.length-1][1].type!=="characterEscape"?f(h):(i.enter("strikethroughSequenceTemporary"),k(h))}function k(h){const b=Y(m);if(h===126)return l>1?f(h):(i.consume(h),l++,k);if(l<2&&!e)return f(h);const w=i.exit("strikethroughSequenceTemporary"),g=Y(h);return w._open=!g||g===2&&!!b,w._close=!b||b===2&&!!g,u(h)}}}class Yt{constructor(){this.map=[]}add(n,e,r){Kt(this,n,e,r)}consume(n){if(this.map.sort((o,i)=>o[0]-i[0]),this.map.length===0)return;let e=this.map.length;const r=[];for(;e>0;)e-=1,r.push(n.slice(this.map[e][0]+this.map[e][1])),r.push(this.map[e][2]),n.length=this.map[e][0];r.push([...n]),n.length=0;let a=r.pop();for(;a;)n.push(...a),a=r.pop();this.map.length=0}}function Kt(t,n,e,r){let a=0;if(!(e===0&&r.length===0)){for(;a<t.map.length;){if(t.map[a][0]===n){t.map[a][1]+=e,t.map[a][2].push(...r);return}a+=1}t.map.push([n,e,r])}}function te(t,n){let e=!1;const r=[];for(;n<t.length;){const a=t[n];if(e){if(a[0]==="enter")a[1].type==="tableContent"&&r.push(t[n+1][1].type==="tableDelimiterMarker"?"left":"none");else if(a[1].type==="tableContent"){if(t[n-1][1].type==="tableDelimiterMarker"){const o=r.length-1;r[o]=r[o]==="left"?"center":"right"}}else if(a[1].type==="tableDelimiterRow")break}else a[0]==="enter"&&a[1].type==="tableDelimiterRow"&&(e=!0);n+=1}return r}const ee={flow:{null:{tokenize:ne,resolveAll:ie}}};function ne(t,n,e){const r=this;let a=0,o=0,i;return u;function u(s){let E=r.events.length-1;for(;E>-1;){const X=r.events[E][1].type;if(X==="lineEnding"||X==="linePrefix")E--;else break}const Q=E>-1?r.events[E][1].type:null,J=Q==="tableHead"||Q==="tableRow"?z:f;return J===z&&r.parser.lazy[r.now().line]?e(s):J(s)}function f(s){return t.enter("tableHead"),t.enter("tableRow"),m(s)}function m(s){return s===124||(i=!0,o+=1),c(s)}function c(s){return s===null?e(s):P(s)?o>1?(o=0,r.interrupt=!0,t.exit("tableRow"),t.enter("lineEnding"),t.consume(s),t.exit("lineEnding"),k):e(s):R(s)?S(t,c,"whitespace")(s):(o+=1,i&&(i=!1,a+=1),s===124?(t.enter("tableCellDivider"),t.consume(s),t.exit("tableCellDivider"),i=!0,c):(t.enter("data"),l(s)))}function l(s){return s===null||s===124||F(s)?(t.exit("data"),c(s)):(t.consume(s),s===92?p:l)}function p(s){return s===92||s===124?(t.consume(s),l):l(s)}function k(s){return r.interrupt=!1,r.parser.lazy[r.now().line]?e(s):(t.enter("tableDelimiterRow"),i=!1,R(s)?S(t,h,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(s):h(s))}function h(s){return s===45||s===58?w(s):s===124?(i=!0,t.enter("tableCellDivider"),t.consume(s),t.exit("tableCellDivider"),b):C(s)}function b(s){return R(s)?S(t,w,"whitespace")(s):w(s)}function w(s){return s===58?(o+=1,i=!0,t.enter("tableDelimiterMarker"),t.consume(s),t.exit("tableDelimiterMarker"),g):s===45?(o+=1,g(s)):s===null||P(s)?D(s):C(s)}function g(s){return s===45?(t.enter("tableDelimiterFiller"),x(s)):C(s)}function x(s){return s===45?(t.consume(s),x):s===58?(i=!0,t.exit("tableDelimiterFiller"),t.enter("tableDelimiterMarker"),t.consume(s),t.exit("tableDelimiterMarker"),y):(t.exit("tableDelimiterFiller"),y(s))}function y(s){return R(s)?S(t,D,"whitespace")(s):D(s)}function D(s){return s===124?h(s):s===null||P(s)?!i||a!==o?C(s):(t.exit("tableDelimiterRow"),t.exit("tableHead"),n(s)):C(s)}function C(s){return e(s)}function z(s){return t.enter("tableRow"),A(s)}function A(s){return s===124?(t.enter("tableCellDivider"),t.consume(s),t.exit("tableCellDivider"),A):s===null||P(s)?(t.exit("tableRow"),n(s)):R(s)?S(t,A,"whitespace")(s):(t.enter("data"),_(s))}function _(s){return s===null||s===124||F(s)?(t.exit("data"),A(s)):(t.consume(s),s===92?yt:_)}function yt(s){return s===92||s===124?(t.consume(s),_):_(s)}}function ie(t,n){let e=-1,r=!0,a=0,o=[0,0,0,0],i=[0,0,0,0],u=!1,f=0,m,c,l;const p=new Yt;for(;++e<t.length;){const k=t[e],h=k[1];k[0]==="enter"?h.type==="tableHead"?(u=!1,f!==0&&(tt(p,n,f,m,c),c=void 0,f=0),m={type:"table",start:Object.assign({},h.start),end:Object.assign({},h.end)},p.add(e,0,[["enter",m,n]])):h.type==="tableRow"||h.type==="tableDelimiterRow"?(r=!0,l=void 0,o=[0,0,0,0],i=[0,e+1,0,0],u&&(u=!1,c={type:"tableBody",start:Object.assign({},h.start),end:Object.assign({},h.end)},p.add(e,0,[["enter",c,n]])),a=h.type==="tableDelimiterRow"?2:c?3:1):a&&(h.type==="data"||h.type==="tableDelimiterMarker"||h.type==="tableDelimiterFiller")?(r=!1,i[2]===0&&(o[1]!==0&&(i[0]=i[1],l=v(p,n,o,a,void 0,l),o=[0,0,0,0]),i[2]=e)):h.type==="tableCellDivider"&&(r?r=!1:(o[1]!==0&&(i[0]=i[1],l=v(p,n,o,a,void 0,l)),o=i,i=[o[1],e,0,0])):h.type==="tableHead"?(u=!0,f=e):h.type==="tableRow"||h.type==="tableDelimiterRow"?(f=e,o[1]!==0?(i[0]=i[1],l=v(p,n,o,a,e,l)):i[1]!==0&&(l=v(p,n,i,a,e,l)),a=0):a&&(h.type==="data"||h.type==="tableDelimiterMarker"||h.type==="tableDelimiterFiller")&&(i[3]=e)}for(f!==0&&tt(p,n,f,m,c),p.consume(n.events),e=-1;++e<n.events.length;){const k=n.events[e];k[0]==="enter"&&k[1].type==="table"&&(k[1]._align=te(n.events,e))}return t}function v(t,n,e,r,a,o){const i=r===1?"tableHeader":r===2?"tableDelimiter":"tableData",u="tableContent";e[0]!==0&&(o.end=Object.assign({},M(n.events,e[0])),t.add(e[0],0,[["exit",o,n]]));const f=M(n.events,e[1]);if(o={type:i,start:Object.assign({},f),end:Object.assign({},f)},t.add(e[1],0,[["enter",o,n]]),e[2]!==0){const m=M(n.events,e[2]),c=M(n.events,e[3]),l={type:u,start:Object.assign({},m),end:Object.assign({},c)};if(t.add(e[2],0,[["enter",l,n]]),r!==2){const p=n.events[e[2]],k=n.events[e[3]];if(p[1].end=Object.assign({},k[1].end),p[1].type="chunkText",p[1].contentType="text",e[3]>e[2]+1){const h=e[2]+1,b=e[3]-e[2]-1;t.add(h,b,[])}}t.add(e[3]+1,0,[["exit",l,n]])}return a!==void 0&&(o.end=Object.assign({},M(n.events,a)),t.add(a,0,[["exit",o,n]]),o=void 0),o}function tt(t,n,e,r,a){const o=[],i=M(n.events,e);a&&(a.end=Object.assign({},i),o.push(["exit",a,n])),r.end=Object.assign({},i),o.push(["exit",r,n]),t.add(e+1,0,o)}function M(t,n){const e=t[n],r=e[0]==="enter"?"start":"end";return e[1][r]}const re={tokenize:ae},le={text:{91:re}};function ae(t,n,e){const r=this;return a;function a(f){return r.previous!==null||!r._gfmTasklistFirstContentOfListItem?e(f):(t.enter("taskListCheck"),t.enter("taskListCheckMarker"),t.consume(f),t.exit("taskListCheckMarker"),o)}function o(f){return F(f)?(t.enter("taskListCheckValueUnchecked"),t.consume(f),t.exit("taskListCheckValueUnchecked"),i):f===88||f===120?(t.enter("taskListCheckValueChecked"),t.consume(f),t.exit("taskListCheckValueChecked"),i):e(f)}function i(f){return f===93?(t.enter("taskListCheckMarker"),t.consume(f),t.exit("taskListCheckMarker"),t.exit("taskListCheck"),u):e(f)}function u(f){return P(f)?n(f):R(f)?t.check({tokenize:oe},n,e)(f):e(f)}}function oe(t,n,e){return S(t,r,"whitespace");function r(a){return a===null?e(a):n(a)}}function ue(t){return At([Et,qt(),Xt(t),ee,le])}function se(t){if(typeof t!="string")throw new TypeError("Expected a string");return t.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}const fe={}.hasOwnProperty,he=function(t,n,e,r){let a,o;typeof n=="string"||n instanceof RegExp?(o=[[n,e]],a=r):(o=n,a=e),a||(a={});const i=dt(a.ignore||[]),u=me(o);let f=-1;for(;++f<u.length;)Lt(t,"text",m);return t;function m(l,p){let k=-1,h;for(;++k<p.length;){const b=p[k];if(i(b,h?h.children.indexOf(b):void 0,h))return;h=b}if(h)return c(l,p)}function c(l,p){const k=p[p.length-1],h=u[f][0],b=u[f][1];let w=0;const g=k.children.indexOf(l);let x=!1,y=[];h.lastIndex=0;let D=h.exec(l.value);for(;D;){const C=D.index,z={index:D.index,input:D.input,stack:[...p,l]};let A=b(...D,z);if(typeof A=="string"&&(A=A.length>0?{type:"text",value:A}:void 0),A!==!1&&(w!==C&&y.push({type:"text",value:l.value.slice(w,C)}),Array.isArray(A)?y.push(...A):A&&y.push(A),w=C+D[0].length,x=!0),!h.global)break;D=h.exec(l.value)}return x?(w<l.value.length&&y.push({type:"text",value:l.value.slice(w)}),k.children.splice(g,1,...y)):y=[l],g+y.length}};function me(t){const n=[];if(typeof t!="object")throw new TypeError("Expected array or object as schema");if(Array.isArray(t)){let e=-1;for(;++e<t.length;)n.push([et(t[e][0]),nt(t[e][1])])}else{let e;for(e in t)fe.call(t,e)&&n.push([et(e),nt(t[e])])}return n}function et(t){return typeof t=="string"?new RegExp(se(t),"g"):t}function nt(t){return typeof t=="function"?t:()=>t}const H="phrasing",V=["autolink","link","image","label"],ce={transforms:[ye],enter:{literalAutolink:ge,literalAutolinkEmail:q,literalAutolinkHttp:q,literalAutolinkWww:q},exit:{literalAutolink:xe,literalAutolinkEmail:we,literalAutolinkHttp:ke,literalAutolinkWww:be}},pe={unsafe:[{character:"@",before:"[+\\-.\\w]",after:"[\\-.\\w]",inConstruct:H,notInConstruct:V},{character:".",before:"[Ww]",after:"[\\-.\\w]",inConstruct:H,notInConstruct:V},{character:":",before:"[ps]",after:"\\/",inConstruct:H,notInConstruct:V}]};function ge(t){this.enter({type:"link",title:null,url:"",children:[]},t)}function q(t){this.config.enter.autolinkProtocol.call(this,t)}function ke(t){this.config.exit.autolinkProtocol.call(this,t)}function be(t){this.config.exit.data.call(this,t);const n=this.stack[this.stack.length-1];n.url="http://"+this.sliceSerialize(t)}function we(t){this.config.exit.autolinkEmail.call(this,t)}function xe(t){this.exit(t)}function ye(t){he(t,[[/(https?:\/\/|www(?=\.))([-.\w]+)([^ \t\r\n]*)/gi,De],[/([-.\w+]+)@([-\w]+(?:\.[-\w]+)+)/g,Ce]],{ignore:["link","linkReference"]})}function De(t,n,e,r,a){let o="";if(!bt(a)||(/^w/i.test(n)&&(e=n+e,n="",o="http://"),!Ae(e)))return!1;const i=Fe(e+r);if(!i[0])return!1;const u={type:"link",title:null,url:o+n+i[0],children:[{type:"text",value:n+i[0]}]};return i[1]?[u,{type:"text",value:i[1]}]:u}function Ce(t,n,e,r){return!bt(r,!0)||/[-\d_]$/.test(e)?!1:{type:"link",title:null,url:"mailto:"+n+"@"+e,children:[{type:"text",value:n+"@"+e}]}}function Ae(t){const n=t.split(".");return!(n.length<2||n[n.length-1]&&(/_/.test(n[n.length-1])||!/[a-zA-Z\d]/.test(n[n.length-1]))||n[n.length-2]&&(/_/.test(n[n.length-2])||!/[a-zA-Z\d]/.test(n[n.length-2])))}function Fe(t){const n=/[!"&'),.:;<>?\]}]+$/.exec(t);if(!n)return[t,void 0];t=t.slice(0,n.index);let e=n[0],r=e.indexOf(")");const a=K(t,"(");let o=K(t,")");for(;r!==-1&&a>o;)t+=e.slice(0,r+1),e=e.slice(r+1),r=e.indexOf(")"),o++;return[t,e]}function bt(t,n){const e=t.input.charCodeAt(t.index-1);return(t.index===0||I(e)||N(e))&&(!n||e!==47)}wt.peek=Oe;function de(){return{enter:{gfmFootnoteDefinition:Se,gfmFootnoteDefinitionLabelString:ze,gfmFootnoteCall:Me,gfmFootnoteCallString:Ie},exit:{gfmFootnoteDefinition:Re,gfmFootnoteDefinitionLabelString:Te,gfmFootnoteCall:Pe,gfmFootnoteCallString:Ee}}}function Le(){return{unsafe:[{character:"[",inConstruct:["phrasing","label","reference"]}],handlers:{footnoteDefinition:je,footnoteReference:wt}}}function Se(t){this.enter({type:"footnoteDefinition",identifier:"",label:"",children:[]},t)}function ze(){this.buffer()}function Te(t){const n=this.resume(),e=this.stack[this.stack.length-1];e.label=n,e.identifier=j(this.sliceSerialize(t)).toLowerCase()}function Re(t){this.exit(t)}function Me(t){this.enter({type:"footnoteReference",identifier:"",label:""},t)}function Ie(){this.buffer()}function Ee(t){const n=this.resume(),e=this.stack[this.stack.length-1];e.label=n,e.identifier=j(this.sliceSerialize(t)).toLowerCase()}function Pe(t){this.exit(t)}function wt(t,n,e,r){const a=W(r);let o=a.move("[^");const i=e.enter("footnoteReference"),u=e.enter("reference");return o+=a.move(at(e,ot(t),{...a.current(),before:o,after:"]"})),u(),i(),o+=a.move("]"),o}function Oe(){return"["}function je(t,n,e,r){const a=W(r);let o=a.move("[^");const i=e.enter("footnoteDefinition"),u=e.enter("label");return o+=a.move(at(e,ot(t),{...a.current(),before:o,after:"]"})),u(),o+=a.move("]:"+(t.children&&t.children.length>0?" ":"")),a.shift(4),o+=a.move(St(zt(t,e,a.current()),_e)),i(),o}function _e(t,n,e){return n===0?t:(e?"":"    ")+t}const ve=["autolink","destinationLiteral","destinationRaw","reference","titleQuote","titleApostrophe"];xt.peek=qe;const We={canContainEols:["delete"],enter:{strikethrough:He},exit:{strikethrough:Ve}},Be={unsafe:[{character:"~",inConstruct:"phrasing",notInConstruct:ve}],handlers:{delete:xt}};function He(t){this.enter({type:"delete",children:[]},t)}function Ve(t){this.exit(t)}function xt(t,n,e,r){const a=W(r),o=e.enter("strikethrough");let i=a.move("~~");return i+=ut(t,e,{...a.current(),before:i,after:"~"}),i+=a.move("~~"),o(),i}function qe(){return"~"}function Ue(t){return t.length}function Ge(t,n){const e=n||{},r=(e.align||[]).concat(),a=e.stringLength||Ue,o=[],i=[],u=[],f=[];let m=0,c=-1;for(;++c<t.length;){const b=[],w=[];let g=-1;for(t[c].length>m&&(m=t[c].length);++g<t[c].length;){const x=$e(t[c][g]);if(e.alignDelimiters!==!1){const y=a(x);w[g]=y,(f[g]===void 0||y>f[g])&&(f[g]=y)}b.push(x)}i[c]=b,u[c]=w}let l=-1;if(typeof r=="object"&&"length"in r)for(;++l<m;)o[l]=it(r[l]);else{const b=it(r);for(;++l<m;)o[l]=b}l=-1;const p=[],k=[];for(;++l<m;){const b=o[l];let w="",g="";b===99?(w=":",g=":"):b===108?w=":":b===114&&(g=":");let x=e.alignDelimiters===!1?1:Math.max(1,f[l]-w.length-g.length);const y=w+"-".repeat(x)+g;e.alignDelimiters!==!1&&(x=w.length+x+g.length,x>f[l]&&(f[l]=x),k[l]=x),p[l]=y}i.splice(1,0,p),u.splice(1,0,k),c=-1;const h=[];for(;++c<i.length;){const b=i[c],w=u[c];l=-1;const g=[];for(;++l<m;){const x=b[l]||"";let y="",D="";if(e.alignDelimiters!==!1){const C=f[l]-(w[l]||0),z=o[l];z===114?y=" ".repeat(C):z===99?C%2?(y=" ".repeat(C/2+.5),D=" ".repeat(C/2-.5)):(y=" ".repeat(C/2),D=y):D=" ".repeat(C)}e.delimiterStart!==!1&&!l&&g.push("|"),e.padding!==!1&&!(e.alignDelimiters===!1&&x==="")&&(e.delimiterStart!==!1||l)&&g.push(" "),e.alignDelimiters!==!1&&g.push(y),g.push(x),e.alignDelimiters!==!1&&g.push(D),e.padding!==!1&&g.push(" "),(e.delimiterEnd!==!1||l!==m-1)&&g.push("|")}h.push(e.delimiterEnd===!1?g.join("").replace(/ +$/,""):g.join(""))}return h.join(`
`)}function $e(t){return t==null?"":String(t)}function it(t){const n=typeof t=="string"?t.codePointAt(0):0;return n===67||n===99?99:n===76||n===108?108:n===82||n===114?114:0}const Ne={enter:{table:Ze,tableData:rt,tableHeader:rt,tableRow:Je},exit:{codeText:Xe,table:Qe,tableData:U,tableHeader:U,tableRow:U}};function Ze(t){const n=t._align;this.enter({type:"table",align:n.map(e=>e==="none"?null:e),children:[]},t),this.setData("inTable",!0)}function Qe(t){this.exit(t),this.setData("inTable")}function Je(t){this.enter({type:"tableRow",children:[]},t)}function U(t){this.exit(t)}function rt(t){this.enter({type:"tableCell",children:[]},t)}function Xe(t){let n=this.resume();this.getData("inTable")&&(n=n.replace(/\\([\\|])/g,Ye));const e=this.stack[this.stack.length-1];e.value=n,this.exit(t)}function Ye(t,n){return n==="|"?n:t}function Ke(t){const n=t||{},e=n.tableCellPadding,r=n.tablePipeAlign,a=n.stringLength,o=e?" ":"|";return{unsafe:[{character:"\r",inConstruct:"tableCell"},{character:`
`,inConstruct:"tableCell"},{atBreak:!0,character:"|",after:"[	 :-]"},{character:"|",inConstruct:"tableCell"},{atBreak:!0,character:":",after:"-"},{atBreak:!0,character:"-",after:"[:|-]"}],handlers:{table:i,tableRow:u,tableCell:f,inlineCode:p}};function i(k,h,b,w){return m(c(k,b,w),k.align)}function u(k,h,b,w){const g=l(k,b,w),x=m([g]);return x.slice(0,x.indexOf(`
`))}function f(k,h,b,w){const g=b.enter("tableCell"),x=b.enter("phrasing"),y=ut(k,b,{...w,before:o,after:o});return x(),g(),y}function m(k,h){return Ge(k,{align:h,alignDelimiters:r,padding:e,stringLength:a})}function c(k,h,b){const w=k.children;let g=-1;const x=[],y=h.enter("table");for(;++g<w.length;)x[g]=l(w[g],h,b);return y(),x}function l(k,h,b){const w=k.children;let g=-1;const x=[],y=h.enter("tableRow");for(;++g<w.length;)x[g]=f(w[g],k,h,b);return y(),x}function p(k,h,b){let w=Tt(k,h,b);return b.stack.includes("tableCell")&&(w=w.replace(/\|/g,"\\$&")),w}}const tn={exit:{taskListCheckValueChecked:lt,taskListCheckValueUnchecked:lt,paragraph:nn}},en={unsafe:[{atBreak:!0,character:"-",after:"[:|-]"}],handlers:{listItem:rn}};function lt(t){const n=this.stack[this.stack.length-2];n.checked=t.type==="taskListCheckValueChecked"}function nn(t){const n=this.stack[this.stack.length-2];if(n&&n.type==="listItem"&&typeof n.checked=="boolean"){const e=this.stack[this.stack.length-1],r=e.children[0];if(r&&r.type==="text"){const a=n.children;let o=-1,i;for(;++o<a.length;){const u=a[o];if(u.type==="paragraph"){i=u;break}}i===e&&(r.value=r.value.slice(1),r.value.length===0?e.children.shift():e.position&&r.position&&typeof r.position.start.offset=="number"&&(r.position.start.column++,r.position.start.offset++,e.position.start=Object.assign({},r.position.start)))}}this.exit(t)}function rn(t,n,e,r){const a=t.children[0],o=typeof t.checked=="boolean"&&a&&a.type==="paragraph",i="["+(t.checked?"x":" ")+"] ",u=W(r);o&&u.move(i);let f=Rt(t,n,e,{...r,...u.current()});return o&&(f=f.replace(/^(?:[*+-]|\d+\.)([\r\n]| {1,3})/,m)),f;function m(c){return c+i}}function ln(){return[ce,de(),We,Ne,tn]}function an(t){return{extensions:[pe,Le(),Be,Ke(t),en]}}function Ln(t={}){const n=this.data();e("micromarkExtensions",ue(t)),e("fromMarkdownExtensions",ln()),e("toMarkdownExtensions",an(t));function e(r,a){(n[r]?n[r]:n[r]=[]).push(a)}}export{Ln as default};
