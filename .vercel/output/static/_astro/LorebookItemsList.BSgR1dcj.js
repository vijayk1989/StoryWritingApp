import{j as e}from"./jsx-runtime.B-tYHWOS.js";import{u as v,a as R}from"./useLorebookStore.GsEaYorD.js";import{b as _,R as A}from"./index.BuzRTTe3.js";import{_ as x}from"./index.BInd9SeV.js";import{O as w,P as z,C as k,a as P,T as C,D,R as O,A as B,d as F,e as V,f as H}from"./index.CBFvVGSl.js";import{c as p,B as g}from"./button.DSwAMVRZ.js";import{r as d}from"./index.BCPtUIm2.js";import{b as q}from"./index.CkCWt44i.js";import{L as m,I as u,S as f,a as j,b as y,c as N,d as b,T as M}from"./select.DN5dgNIo.js";import"./supabase.YDNJ6__1.js";import"./index.Bk4Tk5ow.js";import"./react.BoqmBW-A.js";import"./iconBase.wJcibKWI.js";import"./index.D1eIsul2.js";import"./floating-ui.react-dom.BmbJoTtk.js";/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=q("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),W=O,Y=z,S=d.forwardRef(({className:a,...t},l)=>e.jsx(w,{ref:l,className:p("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...t}));S.displayName=w.displayName;const I=d.forwardRef(({className:a,children:t,...l},i)=>e.jsxs(Y,{children:[e.jsx(S,{}),e.jsxs(k,{ref:i,className:p("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...l,children:[t,e.jsxs(P,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(X,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));I.displayName=k.displayName;const L=({className:a,...t})=>e.jsx("div",{className:p("flex flex-col space-y-1.5 text-center sm:text-left",a),...t});L.displayName="DialogHeader";const E=d.forwardRef(({className:a,...t},l)=>e.jsx(C,{ref:l,className:p("text-lg font-semibold leading-none tracking-tight",a),...t}));E.displayName=C.displayName;const G=d.forwardRef(({className:a,...t},l)=>e.jsx(D,{ref:l,className:p("text-sm text-muted-foreground",a),...t}));G.displayName=D.displayName;const J=["Character","Item","Location"],K=["Background","Artifact","Spell","Protagonist","Antagonist","Plot","Other"];function Q({item:a,onClose:t}){const{updateLorebookItem:l}=v(),[i,n]=d.useState({name:"",tags:"",classification:"Character",lore_type:"Background",description:""});d.useEffect(()=>{a&&n({name:a.name,tags:a.tags||"",classification:a.classification,lore_type:a.lore_type,description:a.description||""})},[a]);const h=async s=>{if(s.preventDefault(),!!a)try{await l(a.id,{...i,lorebook_id:a.lorebook_id}),x.success("Item updated successfully"),t()}catch(r){x.error("Failed to update item"),console.error("Failed to update lorebook item:",r)}};return e.jsx(W,{open:!!a,onOpenChange:()=>t(),children:e.jsxs(I,{className:"sm:max-w-[600px] bg-white text-gray-900",children:[e.jsx(L,{children:e.jsx(E,{children:"Edit Lorebook Item"})}),e.jsxs("form",{onSubmit:h,className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Name"}),e.jsx(u,{value:i.name,onChange:s=>n(r=>({...r,name:s.target.value})),placeholder:"Enter name",className:"bg-white border-gray-300",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Tags (comma-separated)"}),e.jsx(u,{value:i.tags,onChange:s=>n(r=>({...r,tags:s.target.value})),placeholder:"tag1, tag2, tag3",className:"bg-white border-gray-300"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Classification"}),e.jsxs(f,{value:i.classification,onValueChange:s=>n(r=>({...r,classification:s})),children:[e.jsx(j,{className:"bg-white border-gray-300",children:e.jsx(y,{placeholder:"Select classification"})}),e.jsx(N,{className:"bg-white",children:J.map(s=>e.jsx(b,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Lore Type"}),e.jsxs(f,{value:i.lore_type,onValueChange:s=>n(r=>({...r,lore_type:s})),children:[e.jsx(j,{className:"bg-white border-gray-300",children:e.jsx(y,{placeholder:"Select lore type"})}),e.jsx(N,{className:"bg-white",children:K.map(s=>e.jsx(b,{value:s,children:s},s))})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Description"}),e.jsx(M,{value:i.description,onChange:s=>n(r=>({...r,description:s.target.value})),placeholder:"Enter description",className:"min-h-[150px] bg-white border-gray-300",required:!0})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx(g,{type:"button",variant:"outline",onClick:t,className:"border-gray-300",children:"Cancel"}),e.jsx(g,{type:"submit",children:"Save Changes"})]})]})]})})}function pe({lorebookId:a}){const{data:t,error:l,isLoading:i}=R(a),{deleteLorebookItem:n}=v(),[h,s]=d.useState(null),r=async o=>{try{await n(o,a),x.success("Item deleted successfully")}catch(c){x.error("Failed to delete item"),console.error("Error deleting item:",c)}};return l?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-red-500",children:"Error loading lorebook items"})}):i?e.jsx("div",{className:"text-center py-12",children:e.jsxs("svg",{className:"animate-spin h-8 w-8 text-blue-600 mx-auto",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}):t?.length?e.jsxs(e.Fragment,{children:[e.jsx(B,{type:"single",collapsible:!0,className:"space-y-4 mt-8",children:t.map(o=>e.jsxs(F,{value:o.id,className:"border border-gray-200 rounded-lg bg-white shadow-sm",children:[e.jsxs("div",{className:"flex items-center px-6",children:[e.jsxs("div",{className:"flex-1 flex items-center gap-4 py-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:o.name}),e.jsx("div",{className:"flex gap-2",children:e.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-800",children:o.classification})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(g,{variant:"ghost",size:"icon",onClick:c=>{c.stopPropagation(),s(o)},className:"text-gray-400 hover:text-blue-600",title:"Edit item",children:e.jsx(_,{className:"w-5 h-5"})}),e.jsx(g,{variant:"ghost",size:"icon",onClick:c=>{c.stopPropagation(),r(o.id)},className:"text-gray-400 hover:text-red-600",title:"Delete item",children:e.jsx(A,{className:"w-5 h-5"})}),e.jsx(V,{className:"hover:no-underline"})]})]}),e.jsx(H,{className:"border-t px-6",children:e.jsxs("div",{className:"py-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Type:"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:o.lore_type})]}),o.tags&&e.jsx("div",{className:"flex flex-wrap gap-2",children:o.tags.split(",").map((c,T)=>e.jsxs("span",{className:"text-sm text-gray-500",children:["#",c.trim()]},T))}),e.jsx("p",{className:"text-gray-700 whitespace-pre-wrap",children:o.description||"No description provided."})]})})]},o.id))}),e.jsx(Q,{item:h,onClose:()=>s(null)})]}):e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500",children:"No items in this lorebook yet."})})}export{pe as default};
